<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="/css/document.css" />

    <title>404</title>
    <meta name="description" content="Page not found" />
    <meta name="author" content="Bobby Jack" />
</head>
<body>

<article>
    <h1>Page not found</h1>

    <!--
    <p><a href="mailto:bobbyjack@gmail.com?subject=Broken+link">email</a></p>

    <script>document.writeln("referrer: " + document.referrer);</script>
    -->
</article>

<footer>
    <a href="/">
        <img class="logo" src="/images/logo.jpg" alt="Bobby Jack" />
    </a>
</footer>

<script src="/js/stats.js"></script>
<script src="/js/404.js"></script>

<script>
var request = new XMLHttpRequest();

request.addEventListener("load", function() {
    var article = document.querySelector("article");
    var doc = this.responseXML;
    var urls = doc.querySelectorAll("urlset > url > loc");
    var curr = window.location + "";
    var text;
    var locs = [];

    for (var i = 0; i < urls.length; i++) {
        //console.log();
        text = urls[i].textContent;
        locs[i] = { loc: text, dist: getEditDistance(text, curr) };
    }

    locs.sort(function(a, b) {
        return a.dist - b.dist;
    });

    var ul = document.createElement("ul");

    for (var i = 0; i < 5; i++) {
        var li = document.createElement("li");
        ul.appendChild(li);
        a = document.createElement("a");
        a.setAttribute("href", locs[i].loc);
        a.appendChild(document.createTextNode(locs[i].loc));
        li.appendChild(a);
    }

    var h2 = document.createElement("h2");
    h2.appendChild(document.createTextNode("Possible alternatives"));
    article.appendChild(h2);
    article.appendChild(ul);

    //console.log(locs);
});

request.open("GET", "/sitemap.xml");
request.send();


// Compute the edit distance between the two given strings
// From https://en.wikibooks.org/wiki/Algorithm_Implementation/Strings/Levenshtein_distance#JavaScript
// See https://gist.github.com/andrei-m/982927 for proper attribution
function getEditDistance(a, b) {
  if (a.length === 0) return b.length; 
  if (b.length === 0) return a.length;

  var matrix = [];

  // increment along the first column of each row
  var i;
  for (i = 0; i <= b.length; i++) {
    matrix[i] = [i];
  }

  // increment each column in the first row
  var j;
  for (j = 0; j <= a.length; j++) {
    matrix[0][j] = j;
  }

  // Fill in the rest of the matrix
  for (i = 1; i <= b.length; i++) {
    for (j = 1; j <= a.length; j++) {
      if (b.charAt(i-1) == a.charAt(j-1)) {
        matrix[i][j] = matrix[i-1][j-1];
      } else {
        matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution
                                Math.min(matrix[i][j-1] + 1, // insertion
                                         matrix[i-1][j] + 1)); // deletion
      }
    }
  }

  return matrix[b.length][a.length];
};
</script>

</body>

</html>
